<div class="card mb-5 col <%= @options[:classes].join(' ')%>">
  <div class="card-body">
    <div class="row align-items-center">
      <h2 class="card-title col-sm-10 fs-3"><%= bulk_export.title || bulk_export.csv.filename %></h2>
      <%= csv_download_link if bulk_export.csv.attached?%>
    </div>
    <table class="table table-striped table-responsive">
      <thead>
      <tr class="text-center">
        <th scope="col">State</th>
        <th scope="col">Duration (ms)</th>
        <th scope="col">Generated By</th>
        <th scope="col">Generated At</th>
      </tr>
      </thead>
      <tbody>
      <tr class="text-center">
        <td><%= bulk_export.state.titleize %></td>
        <td><%= bulk_export.duration.to_s %></td>
        <td><%= bulk_export.user.email %></td>
        <td><%= bulk_export.generated_at&.to_fs(:display) %></td>
        <td>
          <% if can_regenerate?%>
            <button class="btn btn-outline-primary">Regenerate Export</button>
          <% end %>
        </td>
        <td>
          <% if can_cancel? %>
            <button class="btn btn-outline-secondary">Cancel Export</button>
          <% end %>
        </td>
        <td>
          <% if can_delete? %>
            <button class="btn btn-danger">Delete Export</button>
          <% end %>
        </td>
      </tr>
    </table>
    <h3 class="card-text fs-4">Solr Query Parameters</h3>
    <table class="table table-striped table-responsive">
      <thead>
      <tr>
        <th class="text-center border-0" colspan="2" scope="colgroup">Rows and Sort</th>
        <th class="text-center border-0" colspan="2" scope="colgroup">Search</th>
        <th class="text-center border-0" colspan="2" scope="colgroup">Filter</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <th>Rows</th>
        <td><%= bulk_export.solr_params.dig('rows') %></td>
        <th>All</th>
        <td><%= bulk_export.solr_params.dig('search', 'all') %></td>
        <th>Published</th>
        <td><%= bulk_export.solr_params.dig('filter', 'published')%></td>
      </tr>
      <tr>
        <th>Sort</th>
        <td>
          <%= "#{bulk_export.solr_params.dig('sort', 'field')}," if bulk_export.solr_params.dig('sort', 'field')  %>
          <%= bulk_export.solr_params.dig('sort', 'direction') %></td>
        <th>Fielded</th>
        <td>
          <ul class="list-group">
            <% bulk_export.solr_params.dig('search', 'fielded')&.each do |fielded| %>
              <li class="list-group-item border-0 p-0" style=background:none><%= "#{fielded.dig("opr")} #{fielded.dig("field")}: '#{fielded.dig("term")}'"%></li>
            <% end %>
          </ul>
        </td>
        <th>Created By</th>
        <td><%= bulk_export.solr_params.dig("filter", "created_by") %></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <th>Updated By</th>
        <td><%= bulk_export.solr_params.dig("filter", "updated_by") %></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
