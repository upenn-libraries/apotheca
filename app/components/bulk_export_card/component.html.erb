<div class="card mb-5 col-sm-11">
  <div class="card-body">
    <div class="row align-items-center">
      <h4 class="card-title col-sm-10"><%= @bulk_export.title || bulk_export.csv.filename %></h4>
      <%= csv_download_link if bulk_export.csv.attached?%>
    </div>
    <table class="table table-striped">
      <thead>
      <tr class="text-center">
        <th>State</th>
        <th>Duration (ms)</th>
        <th>Generated By</th>
        <th>Generated At</th>
      </tr>
      </thead>
      <tbody>
      <tr class="text-center">
        <td><%= bulk_export.state.titleize %></td>
        <td><%= bulk_export.duration.to_s %></td>
        <td><%= bulk_export.user.email %></td>
        <td><%= bulk_export.generated_at&.to_fs(:display) %></td>
        <td>
          <% if can_modify?%>
            <button class="btn btn-outline-primary">Regenerate Export</button>
          <% end %>
        </td>
        <td>
          <% if can_modify? %>
            <button class="btn btn-outline-secondary">Cancel Export</button>
          <% end %>
        </td>
        <td>
          <% if can_delete? %>
            <button class="btn btn-danger">Delete Export</button>
          <% end %>
        </td>
      </tr>
    </table>
    <h5>Solr Parameters</h5>
    <table class="table table-striped">
      <thead>
      <tr class="text-center">
        <th>Rows</th>
        <th>Sort</th>
        <th>Filter</th>
        <th class="text-start">Search</th>
      </tr>
      </thead>
      <tbody>
      <tr class=" text-center">
        <td><%= bulk_export.solr_params["rows"] %></td>
        <td><%= bulk_export.solr_params.dig('sort', 'field') %>, <%= bulk_export.solr_params.dig('sort', 'direction') %></td>
        <td>
          <table class="table table-borderless">
            <thead>
            <tr>
              <th>Published</th>
              <th>Created By</th>
              <th>Updated By</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td><%= bulk_export.solr_params.dig('filter', 'published') %></td>
              <td><%= bulk_export.solr_params.dig("filter", "created_by") %></td>
              <td><%= bulk_export.solr_params.dig("filter", "updated_by") %></td>
            </tr>
          </table>
        </td>
        <td>
          <table class="table table-borderless">
            <thead>
            <tr class="text-start">
              <th>All</th>
              <th>Fielded</th>
            </tr>
            </thead>
            <tbody>
            <tr class="text-start">
              <td ><%= bulk_export.solr_params.dig('search', 'all') %></td>
              <td>
                <ul class="list-group list-group-flush">
                  <% bulk_export.solr_params.dig('search', 'fielded').each do |fielded| %>
                    <li class="list-group-item border-0 p-0" style=background:none><%= "#{fielded.dig("opr")} #{fielded.dig("term")} #{fielded.dig("field")}" %></li>
                  <% end %>
                </ul>
              </td>
            </tr>
            </tbody>
          </table>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
